!function(e){function t(e,t){return function(){e.apply(t,arguments)}}function n(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(e,t(i,this),t(o,this))}function r(e){var t=this;return null===this._state?void this._deferreds.push(e):void s(function(){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return void(t._state?e.resolve:e.reject)(t._value);var r;try{r=n(t._value)}catch(i){return void e.reject(i)}e.resolve(r)})}function i(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void c(t(n,e),t(i,this),t(o,this))}this._state=!0,this._value=e,a.call(this)}catch(r){o.call(this,r)}}function o(e){this._state=!1,this._value=e,a.call(this)}function a(){for(var e=0,t=this._deferreds.length;t>e;e++)r.call(this,this._deferreds[e]);this._deferreds=null}function u(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function c(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(i){if(r)return;r=!0,n(i)}}var s=n.immediateFn||"function"==typeof setImmediate&&setImmediate||function(e){setTimeout(e,1)},l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var i=this;return new n(function(n,o){r.call(i,new u(e,t,n,o))})},n.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new n(function(t,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(e){r(o,e)},n)}e[o]=a,0===--i&&t(e)}catch(c){n(c)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)r(o,e[o])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var r=0,i=e.length;i>r;r++)e[r].then(t,n)})},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}(this),function(){"use strict";function e(e){try{return e.sentinel=0,0===Object.getOwnPropertyDescriptor(e,"sentinel").value}catch(t){return!1}}function t(e){if(!window.jQuery)throw new Error("must include jQuery on IE browser");return window.jQuery(e)}function n(e,t){function n(e){if("string"!=typeof e||!e)throw new Error("view id has wrong format")}if("string"!=typeof e||!t)throw new Error("template engine arg have wrong format");if(ie[e])throw new Error("template engine ["+e+"] is already registered");if("function"!=typeof t.render)throw new Error("could not found render method for engine: "+e);var r={};ie[e]={hasView:function(e){return n(e),!!r[e]},getView:function(e){return n(e),r[e]},addView:function(e,t){if(n(e),"string"!=typeof t)throw new Error("view content must be string");r[e]=t},renderView:function(i,o,a,u){n(i);var c=r[i];if(!c)throw new Error('could not found view "'+i+'" on engine '+e);return a.viewId=i,t.render(c,o,a,u)}}}function r(e){if(!ie[e])throw new Error("could not found the template engine: "+e);return ie[e]}function i(){return ue+=1}function o(e){var t=i();return oe[t]=e,ae[t]=0,t}function a(e){return oe[e]}function u(e){e&&void 0!==oe[e]&&(delete oe[e],delete ae[e])}function c(e){void 0!==ae[e]&&(ae[e]+=1)}function s(e){void 0!==ae[e]&&(ae[e]-=1,ae[e]<=0&&u(e))}function l(e){var t,n={};return t=new Promise(function(t,r){n.name=e||"none",n.resolve=t,n.reject=r}),J.mixin(t,n),t}function d(){this.countOfProto=de,this.proto={},this.countOfModules=de,this.modules={},this.views={},this.promises={proto:l("proto"),modules:l("modules"),views:l("views")},this.promiseAll=Promise.all([this.promises.proto,this.promises.modules,this.promises.views]).then(function(){return this}),this.resolveViews()}function f(e,t){if(0===e)throw new Error("component declaration ["+t+"] is already registered")}function h(e,t){0===e&&t()}function p(e){if(e.status===fe.INITIALIZED)throw new Error("component "+e.name+" is already registered")}function m(e,t,n){J.each(n,function(n){t[n]&&(e[n]=t[n],t[n]=null)})}function v(e,t){function n(e){var t=e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()});return"-"===t.charAt(0)?t.substr(1):t}function r(e){return e.length>o.length&&e.substr(e.length-o.length)===o}var i=e.watchers,o="Changed";J.each(t,function(e,t){if(r(t)&&"function"==typeof e){var a=n(t.substr(0,t.length-o.length));i[a]=t}})}function g(e,t){"string"==typeof t.template&&e.addView(t.template,"index"),"object"==typeof t.template&&J.each(t.template,function(t,n){e.addView(t,n)}),t.template=null}function y(e,t){t.style&&(e.style=t.style),t.style=null}function w(e,t){var n=e.elementProto;J.each(t,function(e,r){if(null!==e){var i=J.getDescriptor(t,r);"model"===r?n.model=t.model:J.contains(he,r)?(J.defineProperty(n.__flipper_lifecycle__,r,i),J.contains(pe,r)&&J.defineProperty(n,r,i)):J.defineProperty(n,r,i)}})}function _(e,t){return"function"==typeof e.__flipper_lifecycle__[t]}function b(e,t,n){return e.__flipper_lifecycle__[t].apply(e,n||[])}function C(e,t,n){return _(e,t)?b(e,t,n):void 0}function E(e,t){J.event.trigger(e,t);var n=e.__flipper_when__;n&&n[t]&&J.each(n[t],function(t){"function"==typeof t&&t.call(e)})}function N(e){function t(t){var n=e[t];return function(){n.call(e,this,arguments)}}var n=window.HTMLElement||window.Element,r=J.createObject(n.prototype);return r.__flipper_lifecycle__={},J.defineProperties(r,{model:{value:void 0,writable:!0},modelId:{value:"",writable:!0},getView:{value:e.getView.bind(e)},renderView:{value:function(t,n,r){return"object"==typeof t&&(r=n,n=t,t="index"),r=r||{},r.element=this,e.renderView(t,n,r)}},refresh:{value:function(t,n){function r(){return o?e.handleElement(a):i?e.fetchModel(a,i).then(function(){return e.renderNode(a)}):e.renderNode(a)}var i,o=!1;"function"==typeof t?n=t:t===!0?o=!0:"object"==typeof t&&(i=t),"function"!=typeof n&&(n=function(){});var a=this,u=e.renderComplete.bind(e,a),c=function(){J.event.trigger(a,"refresh")};return Promise.resolve().then(e.renderBegin.bind(e,a)).then(r).then(e.renderSuccess.bind(e,a)).then(n.bind(a))["catch"](e.renderFail.bind(e,a)).then(u,u).then(c)}},createdCallback:{value:t("createdCallback")},attachedCallback:{value:t("attachedCallback")},detachedCallback:{value:t("detachedCallback")},attributeChangedCallback:{value:t("attributeChangedCallback")}}),r}function I(e){this.name=e,this.status=fe.INITIALIZING,this.elementProto=N(this),this.definition=new d,this.templateEngine="default",this.injectionMode="light-dom",this.views={},this.style="",this.helpers={},this.watchers={},this.commands=null,this.definition.ready(this.initialize.bind(this),this.markFailed.bind(this))}function A(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.onload=function(){200===r.status?t(r.responseText):n(r.status)},r.send()}function S(e,t){return/@import/.test(e)&&J.warn("do not supported @import on component sytle. "+t),e}function T(e,t,n){function r(){var n=[];J.eachChildNodes(e,function(e){return e.tagName&&"link"===e.tagName.toLowerCase()&&"stylesheet"===e.getAttribute("rel")},function(e){n.push(e)}),J.each(n,function(n){a.push(new URL(n.getAttribute("href"),t).href),e.removeChild(n)})}function i(){var t=[];J.eachChildNodes(e,function(e){return e.tagName&&"style"===e.tagName.toLowerCase()},function(e){t.push(e)}),J.each(t,function(t){var n=t.innerHTML;o+=n,e.removeChild(t)})}var o="",a=[];return i(),r(),new Promise(function(e,t){var r,i,u=a.length,c=o;return i=function(){e(S(c,n))},u?(r=function(e){c+="\n"+e,u-=1,0===u&&i()},void J.each(a,function(e){A(e,r,function(n){t("fetch link ["+e+"] error, caused by: "+n)})})):void i()})}function L(e,t){e=e.toLowerCase();var n=me[e];n&&n.isReady()?t(n):(ve[e]||(ve[e]=[]),ve[e].push(t))}function P(){return document.baseURI}function j(e){var t=e.ownerDocument?e.ownerDocument.baseURI:"";return t||P()}function O(){return document._currentScript||document.currentScript}function M(){var e=O();return e?e.parentNode:void 0}function k(){var e,t=O(),n=M();return e=n&&n.tagName&&n.tagName.toLowerCase()===$.configs.declarationTag?n.baseURI:t.src?t.src:t.baseURI||t.ownerDocument.baseURI,e||P()}function x(){var e=M();return e?e.getAttribute("name"):""}function R(e){if(!e.isReady()){var t=setTimeout(function(){if(!e.isReady())throw e.initialize(),new Error("component ["+e.name+"] is initialized automatically, forgot [noscript] attribute? ")},1e4);e.on("initialized",function(){clearTimeout(t)})}}function D(e){var t=me[e];if(t){if(t.isReady())throw new Error("component "+t.name+" is already registered")}else t=me[e]=new $.Component(e),t.on("initialized",function(){ve[e]&&(J.each(ve[e],function(e){e(t)}),ve[e]=null)});return me[e]}function F(e,t,n){function r(e){c.mixinProto(o),c.mixinModules(e),t?(c.resolveProto(),c.resolveModules()):R(u)}var i=e.name,o=e.elementProto,a=e.dependencies;if(!i)throw new Error("component name could not be inferred.");var u=D(i),c=u.definition;if(!o)return void u.markFailed("component ["+i+"] prototype could not be inferred.");if(n)return void u.markFailed("component ["+i+"] register error: "+n);if(a){var s=k();J.each(a,function(e,t){"."===e.charAt(0)&&(e=J.resolveUri(e,s),a[t]=e)}),$.require.check()?$.require(a,{success:function(){r(arguments)},error:function(e){var t="error";e&&e.error&&e.error.exception&&(t=e.error.exception),u.markFailed(t)}}):u.markFailed("could not found the global module loader")}else r()}function q(e,t,n){return J.isArray(e)?(n=t,t=e,e=x()):"object"==typeof e||void 0===e?(n=e,t=void 0,e=x()):"string"!=typeof e||J.isArray(t)||(n=t,t=void 0),{name:e,dependencies:t,elementProto:n}}function H(e,t,n){var r=q(e,t,n),i=!0,o=M(),a=o?o.tagName.toLowerCase():"";a===$.configs.declarationTag&&(i=!1),F(r,i)}function V(e){var t=!1,n=j(e);e.hasAttribute("noscript")&&(t=!0);var r,i;r={style:void 0,definitionEle:e,templateEngine:e.getAttribute("template-engine"),injectionMode:e.getAttribute("injection-mode")},i={name:e.getAttribute("name"),dependencies:void 0,elementProto:r},Promise.all([T(e,n,i.name)]).then(function(e){r.style=e,F(i,t)},function(e){F(i,t,e)})}function z(e){return e&&e.tagName&&J.isCustomTag(e.tagName)}function Z(e){return J.isElement(e)&&J.isCustomTag(e.tagName)}function U(e){return $.hasComponent(e.tagName)}function B(e,t,n){function r(t){if(J.debug(t,"has flag on bind",t.__flipper__),Z(t))if(U(t))if(t.resolved){if("success"===e&&"success"!==t.__status__)return;if("error"===e&&"error"!==t.__status__)return;n.call(t)}else t.__flipper_when__||(t.__flipper_when__={}),t.__flipper_when__[e]||(t.__flipper_when__[e]=[]),t.__flipper_when__[e].push(n);else setTimeout(function(){U(t)?r(t):n.call(t)},1e3);else n.call(t)}if(void 0!==t&&null!==t&&("string"!=typeof t&&t.length||(t=[t]),"function"==typeof n))for(var i=0,o=t.length;o>i;i+=1)J.handleNode(t[i],r)}function G(){return $}if(Object.defineProperty&&!document._currentScript){var Q={get:function(){var e=document.currentScript||("complete"!==document.readyState?document.scripts[document.scripts.length-1]:null);return e},configurable:!0};Object.defineProperty(document,"_currentScript",Q)}Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i});var X={templateEngine:"default",injectionMode:"light-dom",declarationTag:"web-component"},$={version:"@@VERSION@@",configs:X,useNative:!!document.registerElement};$.config=function(e,t){if("object"==typeof e&&1===arguments.length)J.mixin(X,e);else{if("string"!=typeof e||2!==arguments.length)throw new Error("unsupoorted config type. key: "+e+", value: "+t);X[e]=t}};var J={};J.noop=function(){},J.each=function(e,t){if(J.isArray(e))for(var n=0,r=e.length;r>n;n+=1)t(e[n],n);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)};var K=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;J.trim=function(e){return"string"==typeof e?e.trim?e.trim():e.replace(K,""):e},J.format=function(e){var t=0;e.replace(/%s/,function(){return t+=1,arguments[t]||""})},J.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},J.contains=function(e,t){if(e.lastIndexOf)return e.lastIndexOf(t)>-1;for(var n=0,r=e.length;r>n;n+=1)if(t===e[n])return!0;return!1},J.isPromise=function(e){return e&&"function"==typeof e.then},J.isElement=function(e){return!(!e||1!==e.nodeType)};var W=!1;J.debug=function(){if(W){var e=J.format.apply(J,arguments);"function"==typeof console.log&&console.log(e)}},J.log=function(e){"function"==typeof console.log&&console.log(e)},J.error=function(e){"function"==typeof console.error?console.error(e.stack||e):J.log(e.stack||e)},J.warn=function(e){console.warn(e.stack||e)};var Y=e({})&&e(document.createElement("div"));J.mixin=function(e,t){if(e)if(Y)J.each(Object.getOwnPropertyNames(t),function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))});else for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},J.defineProperty=function(e,t,n){Y?Object.defineProperty(e,t,n):e[t]=n.value},J.getDescriptor=function(e,t){return Y?Object.getOwnPropertyDescriptor(e,t):{value:e[t]}},J.defineProperties=function(e,t){Y?Object.defineProperties(e,t):J.each(t,function(t,n){J.defineProperty(e,n,t)})},J.createObject=Object.create&&Y?Object.create:function(){var e=function(){};return function(t,n){if(arguments.length>1)throw Error("Second argument not supported");e.prototype=t;var r=new e;return e.prototype=null,n&&J.defineProperties(r,n),r}}(),J.resolveUri=function(e,t){var n=new URL(e,t);return n.href},J.isCustomTag=function(e){return e&&e.lastIndexOf("-")>=0},J.revertEscapedHTML=function(e){return e&&e.replace?e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"):e};var ee=!!window.CustomEvent;if(ee)try{new window.CustomEvent("xyz")}catch(te){ee=!1}var ne=function(){function e(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var n=e.indexOf("Trident/");if(n>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var i=e.indexOf("Edge/");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):!1}return e()}();J.event={on:function(e,n,r){ee&&!ne?e.addEventListener(n,r,!1):t(e).on(n,r)},trigger:function(e,n){if(ee&&!ne){var r=new CustomEvent(n);e.dispatchEvent(r)}else t(e).trigger(n)},halt:function(e){e=e||window.event,e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1)}},J.eachChildNodes=function(e,t,n){var r,i,o,a,u="function"==typeof t;if(e.childNodes)for(i=0,o=e.childNodes.length;o>i&&(r=e.childNodes[i],u&&!t(r)||(a=n(r),a!==!1));i+=1);},J.moveChildNodes=function(e,t){if(t.firstChild&&e.appendChild)for(;t.firstChild;)e.appendChild(t.firstChild)},J.replaceChildNodes=function(e,t){for(var n,r=!1,i=e;t.firstChild;)n=t.firstChild,r?i.parentNode.insertBefore(n,i.nextSibling):(e.parentNode.replaceChild(n,e),r=!0),i=n},J.matchSelector=function(){var e,n,r=document.createElement("div");return r.matches?e="matches":r.matchesSelector?e="matchesSelector":r.mozMatchesSelector?e="mozMatchesSelector":r.oMatchesSelector?e="oMatchesSelector":r.msMatchesSelector&&(e="msMatchesSelector"),n=e?function(t,n){return t[e](n)}:r.querySelectorAll?function(e,t){for(var n=(e.document||e.ownerDocument).querySelectorAll(t),r=0;n[r]&&n[r]!==e;)r+=1;return!!n[r]}:function(e,n){return t(e).is(n)}}(),J.handleNode=function(e,t){if(void 0!==e&&null!==e)if("string"==typeof e&&(e=J.query.all(e)),void 0!==e.length)for(var n=0,r=e.length;r>n;n+=1)t(e[n]);else t(e)},J.cloneNode=function(e){var t,n,r=e.tagName.toLowerCase();if(t=document.createElement(r),e.hasAttributes()){n=e.attributes;for(var i=0,o=n.length;o>i;i+=1)t.setAttribute(n[i].name,n[i].value)}return e.innerHTML&&e.innerHTML.length&&(t.innerHTML=e.innerHTML),t},J.query=function(e,n){return 1===arguments.length&&(n=e,e=document),e.querySelector?e.querySelector(n):t(e).find(n)[0]},J.query.all=function(e,t){if(1===arguments.length&&(t=e,e=document),e.querySelectorAll)return e.querySelectorAll(t);var n=[];return J.requestjQuery(e).find(t).each(function(){n.push(this)}),n};var re={lookupContentNode:function ge(e,t){if(e&&e.childNodes){for(var n,r=e.firstChild;r;)n=r,r=n.nextSibling,1===n.nodeType&&("CONTENT"===n.tagName?t(n):n.childNodes&&n.childNodes.length&&ge(n,t));J.eachChildNodes(e,null,function(e){1===e.nodeType&&("CONTENT"===e.tagName?t(e):e.childNodes&&e.childNodes.length&&re.lookupContentNode(e,t))})}},makeContentFragment:function(e){var t=document.createDocumentFragment();return J.moveChildNodes(t,e),t},handleContentReflect:function(e,t){re.lookupContentNode(t,function(t){var n,r,i=t.getAttribute("select");i?(J.eachChildNodes(e,function(e){return 1===e.nodeType&&J.matchSelector(e,i)},function(e){return r=e,!1}),r?t.hasAttribute("inner")?J.replaceChildNodes(t,r):t.parentNode.replaceChild(r,t):t.hasAttribute("default")?(n=document.createElement("div"),n.innerHTML=t.getAttribute("default"),J.replaceChildNodes(t,n)):t.parentNode.removeChild(t)):J.replaceChildNodes(t,e)})}},ie={};n("default",{render:function(e){return e}}),$.registerTemplateEngine=n,$.getTemplateEngine=r,$.require=function(){window.require.apply(null,arguments)},$.require.check=function(){return!!window.require};var oe={},ae={},ue=0;$.dataCenter={_warehouse:oe,requestSpace:o,removeSpace:u,getSpace:a,linkSpace:c,unlinkSpace:s},$.requestSpace=o,$.removeSpace=u;var ce,se={},le={add:function(e,t){se[e]||(ce||(ce=document.createElement("style"),(document.head||document.body).appendChild(ce)),t&&t.length&&(ce.textContent+=t),se[e]=!0)}},de=2;d.prototype={ready:function(e,t){return this.promiseAll.then(e)["catch"](t)},mixinProto:function(e){function t(e){f(n.countOfProto,"element prototype"),J.mixin(n.proto,e),n.countOfProto-=1,h(n.countOfProto,n.resolveProto.bind(n))}var n=this;if("object"==typeof e)t(e);else{if("function"!=typeof e)throw new Error("element prototype has wrong format");n.promises.modules.then(function(n){var r=e.apply(null,n);t(r)})}},resolveProto:function(){this.promises.proto.resolve(this.proto)},mixinModules:function(e){var t=this;f(t.countOfModules,"element dependencies"),e&&(this.modules=e),this.countOfModules-=1,h(t.countOfModules,t.resolveModules.bind(t))},resolveModules:function(){this.promises.modules.resolve(this.modules)},rejectModules:function(e){this.promises.modules.reject(e)},resolveViews:function(){this.promises.views.resolve(this.views)}};var fe={ERROR:"ERROR",INITIALIZING:"INITIALIZING",INITIALIZED:"INITIALIZED"},he=["initialize","fetch","adapt","render","ready","destroy","fail"],pe=["fetch","adapt","render"];I.prototype={on:function(e,t){this.__events__||(this.__events__={}),this.__events__[e]||(this.__events__[e]=[]),this.__events__[e].push(t)},fire:function(e,t){var n=this;this.__events__&&this.__events__[e]&&J.each(this.__events__[e],function(e){e.apply(n,t||[])})},isReady:function(){return this.status===fe.INITIALIZED},prepare:function(e){p(this),e&&(m(this,e,["templateEngine","injectionMode","definitionEle","helpers","commands"]),v(this,e),g(this,e),y(this,e),w(this,e))},initialize:function(){p(this),this.prepare(this.definition.proto),$.useNative&&document.registerElement(this.name,{prototype:this.elementProto}),$.useNative||document.createElement(this.name),this.status=fe.INITIALIZED,this.definition=null,this.fire("initialized")},transform:function(e,t){if(this.status===fe.INITIALIZING)this.on("initialized",function(){this.transform(e)});else if(this.status===fe.INITIALIZED&&!e.__flipper__){var n=J.cloneNode(e);n.__flipper_when__=e.__flipper_when__,e.parentNode.replaceChild(n,e),e=n,J.mixin(e,this.elementProto),e.createdCallback(),e.attachedCallback()}},markFailed:function(e){this.status=fe.ERROR,"string"==typeof e&&(e=new Error(e)),this.fire("initialized",[e]),J.error(e)},addView:function(e,t){this.views[t||"index"]=e+""},getView:function(e){e=e||"index";var t,n=function(n,r){if((n.id||"index")===e){if(t=n.innerHTML,!t&&n.content&&n.content.cloneNode){var i=document.createElement("div");i.appendChild(n.content.cloneNode(!0)),t=i.innerHTML}r&&(t=J.revertEscapedHTML(t))}return t?!1:void 0};return this.views[e]?t=this.views[e]:this.definitionEle&&(J.eachChildNodes(this.definitionEle,function(e){return e.tagName&&"template"===e.tagName.toLowerCase()},function(e){return n(e,!0)}),t||J.eachChildNodes(this.definitionEle,function(e){return e.tagName&&"script"===e.tagName.toLowerCase()&&"template"===e.getAttribute("type")},function(e){return n(e,!1)}),t&&(this.views[e]=t)),t||"index"!==e||(t=" "),t||""},renderView:function(e,t,n){e=e||"index";var r,i,o=$.getTemplateEngine(this.templateEngine),a=this.name+"-"+e;return o.hasView(a)||o.addView(a,this.getView(e)),r=n.element,i=this.commands,"function"==typeof i&&(i=i.call(r)),"object"==typeof i&&(n.commands?J.mixin(n.commands,i):n.commands=i),o.renderView(a,t,n,this)},createdCallback:function(e){J.debug(e,"is created");var t=this.renderComplete.bind(this,e);Promise.resolve().then(this.addLightDomStyle.bind(this,e)).then(this.renderBegin.bind(this,e)).then(this.initElement.bind(this,e)).then(this.handleElement.bind(this,e)).then(this.renderSuccess.bind(this,e))["catch"](this.renderFail.bind(this,e)).then(t,t)},renderBegin:function(e){J.debug(e,"render begin"),e.setAttribute("unresolved",""),e.__flipper__=!0,e.resolved&&(e.resolved=!1),J.debug(e,"has flipper flag",e.__flipper__)},initElement:function(e){return C(e,"initialize")},handleElement:function(e){return Promise.resolve().then(this.fetchModel.bind(this,e)).then(this.renderNode.bind(this,e))},fetchModel:function(e,t){var n,r;return e.hasAttribute("model-key")&&(J.log('"model-key" is a test feature, do not use'),r=$.dataCenter.requestSpace(window[e.getAttribute("model-key")]),e.hasAttribute("model-id")&&($.dataCenter.unlinkSpace(e.getAttribute("model-id")),e.removeAttribute("model-id")),e.setAttribute("model-id",r),e.removeAttribute("model-key")),t?(r="",n=t):_(e,"fetch")?(r="",n=b(e,"fetch")):e.hasAttribute("model-id")&&(r=e.getAttribute("model-id"),n=$.dataCenter.getSpace(r)),!r&&e.hasAttribute("model-id")&&$.dataCenter.unlinkSpace(e.getAttribute("model-id")),Promise.resolve(n).then(function(t){void 0!==t&&(e.model=t,r||(r=$.dataCenter.requestSpace(t)),$.dataCenter.linkSpace(r),e.modelId=r)})},renderNode:function(e){var t,n=this.formatModel(e);return t=_(e,"render")?b(e,"render",[n]):this.renderHTML(e,n),void 0!==t?Promise.resolve(t).then(this.createTree.bind(this,e)):Promise.resolve()},formatModel:function(e){return _(e,"adapt")?b(e,"adapt",[e.model]):e.model},renderHTML:function(e,t){var n="index";return this.renderView(n,t,{element:e})},isLightDom:function(){return"light-dom"===this.injectionMode||"ligth"},createTree:function(e,t){var n,r=this.isLightDom();r?(n=re.makeContentFragment(e),e.innerHTML=t,re.handleContentReflect(n,e)):e.createShadowRoot().innerHTML=t},addLightDomStyle:function(){this.isLightDom()&&le.add(this.name,this.style)},addShadowDomStyle:function(e){if(!this.isLightDom()&&this.style&&this.style.length&&e.shadowRoot&&e.shadowRoot.innerHTML){var t=document.createElement("style");t.textContent=this.style,e.shadowRoot.appendChild(t)}},renderFail:function(e,t){J.debug(e,"render fail"),J.error(t);var n=C(e,"fail",[t]);return $.useNative||$.parse(e),Promise.resolve(n).then(function(){e.__status__="error",e.__error__=t,E(e,"error")})},renderSuccess:function(e){J.debug(e,"render success"),this.isLightDom()||this.addShadowDomStyle(e),$.useNative||$.parse(e),E(e,"rendered");var t=C(e,"ready");return Promise.resolve(t).then(function(){e.__status__="success",e.removeAttribute("unresolved"),E(e,"success")})},renderComplete:function(e){J.debug(e,"render complete"),e.resolved=!0,E(e,"ready"),e.__flipper_when___&&(e.__flipper_when__=null,delete e.__flipper_when__)},detachedCallback:function(e){this.destroy(e)},destroy:function(e){C(e,"destroy"),e.modelId&&($.dataCenter.unlinkSpace(e.modelId),e.modelId=void 0,e.model=void 0),J.event.trigger(e,"destroy")},attachedCallback:function(){},attributeChangedCallback:function(e,t){var n,r,i;"function"==typeof e.attributeChanged?e.attributeChanged.apply(e,t):(n=this.watchers,r=t[0],n[r]&&(i=e[n[r]],"function"==typeof i&&i.apply(e,Array.prototype.slice.call(t,1))))},setHelpers:function(e){this.helpers=e},getHelpers:function(){return this.helpers}},$.Component=I;var me={},ve={};$.define=$.register=H,$.useNative&&document.registerElement($.configs.declarationTag,{prototype:J.createObject(HTMLElement.prototype,{createdCallback:{value:function(){V(this)}}})}),window.FlipperPolyfill&&window.FlipperPolyfill.flushDeclaration($.register.bind($)),$.getComponent=function(e){return me[e.toLowerCase()]},$.hasComponent=function(e){return!!$.getComponent(e)},$.getComponentHelpers=function(e){var t=$.getComponent(e);return t?t.getHelpers():{}},$.components=me,$.init=function(e){function t(e){if(!z(e))return!1;if(e.initialized)return!1;if(e.initialing)return!1;var t=$.getComponent(e.tagName);t&&t.isReady()?t.transform(e):(e.initialing=!0,L(e.tagName,function(t){t.transform(e,!0),delete e.initialing}))}return $.useNative?!1:(J.handleNode(e,t),!0)},$.parse=function(e){return $.useNative?!1:void J.handleNode(e,function(e){J.eachChildNodes(e,void 0,function(e){z(e)?$.init(e):e.childNodes&&e.childNodes.length&&$.parse(e)})})},$.useNative||!function(){function e(e){(document.addEventListener||e&&"load"===e.type||"complete"===document.readyState)&&(t(),n=!0,$.parse(document.body))}function t(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",e,!1),window.removeEventListener("load",e,!1)):(document.detachEvent("onreadystatechange",e),window.detachEvent("onload",e))}var n=!1;if("complete"===document.readyState)setTimeout(e,1);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e);var r=!1;try{r=!window.frameElement&&document.documentElement}catch(i){}r&&r.doScroll&&!function o(){if(!n){try{r.doScroll("left")}catch(i){return setTimeout(o,50)}t(),e()}}()}}(),$.findShadow=function(e,t){return J.query.all(e.shadowRoot,t)},$.whenError=function(e,t){B("error",e,t)},$.whenSuccess=function(e,t){B("success",e,t)},$.whenReady=function(e,t){B("ready",e,t)},$.waitReady=function(e,t){return void 0!==e&&null!==e?("string"!=typeof e&&e.length||(e=[e]),new Promise(function(n,r){function i(){"function"==typeof t&&t(),n()}function o(){a-=1,0===a&&i()}var a=e.length;$.whenSuccess(e,o),$.whenError(e,r)})):void 0},window.Flipper=G()}();