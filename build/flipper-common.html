<link href="./modules/bootstrap/css/bootstrap.css" rel="stylesheet">

<!--script src="./modules/modulex/modulex-debug.js"></script-->
<script src="http://g.alicdn.com/kissy/5/0.2.0/seed-debug.js"></script>
<script src="./modules/jquery/jquery.js"></script>
<script src="./modules/bootstrap/js/bootstrap.js"></script>
<script src="./modules/xtemplate/xtemplate-standalone-debug.js"></script>

<script src="./flipper.js"></script>

<script>
require.config({
    packages: {
        core: {
            combine: true,
            base: '//g.alicdn.com/kissy/5/0.2.0/'
        }
    }
});

define('jquery', function() {
    return jQuery;
});

define('xtemplate', function() {
    return XTemplate;
});

(function() {
    var compiledView = {};

    function compileView(viewId, viewContent) {
        if (viewId) {
            if (!compiledView[viewId]) {
                compiledView[viewId] = new XTemplate(viewContent);
            }
            return compiledView[viewId];
        } else {
            return new XTemplate(viewContent);
        }
    }

    function renderView(viewContent, data, option) {
        var viewId = option.viewId,
            element = option.element,
            compiledView = compileView(viewId, viewContent);

        var commands = option.commands || {};
        commands.attr = function(scope, option) {
            var key = option.params && option.params[0];
            return key ? element.getAttribute(key) : key;
        };

        commands.modelId = function() {
            return element.modelId || '';
        };

        option.commands = commands;

        return compiledView.render(data, option);
    }

    Flipper.registerTemplateEngine('xtpl', {
        render: renderView
    });
}());
</script>
