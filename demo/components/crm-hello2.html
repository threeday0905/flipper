<web-component name="crm-hello2" template-engine="xtpl">
    <!-- 可以使用外連樣式 -->
    <link rel="stylesheet" href="./crm-hello2.css">

    <!-- {{attr("xxx")}} 是預設提供的模版命令行，可以從attr上取值-->
    <template>
        <section>
            <span>crm-hello2</span>
            <h1>Hello {{name}}</h1>
            <small>called by key: "{{attr("key") }}"" </small>
            <hr>
            <button>Say Hi</button>
        </section>
    </template>
    <script>

    /* register的第一個參數會轉發給KISSY.require作為依賴模塊 */
    Flipper.register(['lib/jquery/2.1.3/', '../data/title.js'], function($, data) {

        return {
            /* 開始時會調用*/
            initialize: function() {
                this.key = this.getAttribute('key');
            },
            /* fetch數據會回傳一個model，作為渲染時用, 可回傳Promise也可接受PlainObject */
            fetch: function() {
                /* 初始化時加上的屬性 */
                var key = this.key;

                /* 可以直接回傳一個對象，也可以回傳一個符合Promise規範的ajax */
                return {
                    name: data[key] || 'n/a'
                };
            },

            /* 渲染結束時會調用 */
            ready: function() {
                /* model就是fetch回傳的對象 */
                var model = this.model;

                /* 可以綁定dom事件*/
                $(this).find('button').on('click', function() {
                    window.alert('hi! ' + model.name);
                });
            },
            /* 對外公開的api*/
            getName: function() {
                return this.model.name;
            },
            punch: function(targetName) {
                window.alert(this.getName() + ' punch ' + targetName);
            }
        };
    });
    </script>
</web-component>
